import{r as o}from"./react-c38fdf14.js";import{V as S,L as U,D as b}from"./deckgl_core-d179406b.js";const D=typeof window<"u"?o.useLayoutEffect:o.useEffect,I=D;function m(e,t){for(;e;){if(e===t)return!0;e=Object.getPrototypeOf(e)}return!1}const _={position:"absolute",zIndex:-1};function j(e,t){if(typeof e=="function")return e(t);if(Array.isArray(e))return e.map(r=>j(r,t));if(R(e)){if(A(e))return t.style=_,o.cloneElement(e,t);if(q(e))return o.cloneElement(e,t)}return e}function R(e){return e&&typeof e=="object"&&"type"in e||!1}function A(e){var t;return(t=e.props)===null||t===void 0?void 0:t.mapStyle}function q(e){const t=e.type;return t&&t.deckGLViewProps}function C(e){if(typeof e=="function")return o.createElement(S,{},e);if(Array.isArray(e))return e.map(C);if(R(e)){if(e.type===o.Fragment)return C(e.props.children);if(m(e.type,S))return e}return e}function P({children:e,layers:t=[],views:r=null}){const s=[],c=[],n={};return o.Children.forEach(C(e),i=>{if(R(i)){const a=i.type;if(m(a,U)){const d=z(a,i.props);c.push(d)}else s.push(i);if(m(a,S)&&a!==S&&i.props.id){const d=new a(i.props);n[d.id]=d}}else i&&s.push(i)}),Object.keys(n).length>0&&(Array.isArray(r)?r.forEach(i=>{n[i.id]=i}):r&&(n[r.id]=r),r=Object.values(n)),t=c.length>0?[...c,...t]:t,{layers:t,children:s,views:r}}function z(e,t){const r={},s=e.defaultProps||{};for(const c in t)s[c]!==t[c]&&(r[c]=t[c]);return new e(r)}function G({children:e,deck:t,ContextProvider:r}){const{viewManager:s}=t||{};if(!s||!s.views.length)return[];const c={},n=s.views[0].id;for(const i of e){let a=n,d=i;R(i)&&m(i.type,S)&&(a=i.props.id||n,d=i.props.children);const f=s.getViewport(a),p=s.getViewState(a);if(f){p.padding=f.padding;const{x:v,y:k,width:y,height:w}=f;d=j(d,{x:v,y:k,width:y,height:w,viewport:f,viewState:p}),c[a]||(c[a]={viewport:f,children:[]}),c[a].children.push(d)}}return Object.keys(c).map(i=>{const{viewport:a,children:d}=c[i],{x:f,y:p,width:v,height:k}=a,y={position:"absolute",left:f,top:p,width:v,height:k},w="view-".concat(i),h=o.createElement("div",{key:w,id:w,style:y},...d);if(r){const V={viewport:a,container:t.canvas.offsetParent,eventManager:t.eventManager,onViewStateChange:g=>{g.viewId=i,t._onViewStateChange(g)}};return o.createElement(r,{key:w,value:V},h)}return h})}const Y={mixBlendMode:null};function $({width:e,height:t,style:r}){const s={position:"absolute",zIndex:0,left:0,top:0,width:e,height:t},c={left:0,top:0};if(r)for(const n in r)n in Y?c[n]=r[n]:s[n]=r[n];return{containerStyle:s,canvasStyle:c}}function F(e){return{get deck(){return e.deck},pickObject:t=>e.deck.pickObject(t),pickMultipleObjects:t=>e.deck.pickMultipleObjects(t),pickObjects:t=>e.deck.pickObjects(t)}}function x(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}function H(e,t,r){const s=new t({...r,_customRender:c=>{e.redrawReason=c;const n=s.getViewports();e.lastRenderedViewports!==n?e.forceUpdate():x(e)}});return s}const E=o.forwardRef((e,t)=>{const[r,s]=o.useState(0),n=o.useRef({control:null,version:r,forceUpdate:()=>s(u=>u+1)}).current,i=o.useRef(null),a=o.useRef(null),d=o.useMemo(()=>P(e),[e.layers,e.views,e.children]);let f=!0;const p=u=>{var l;return f&&e.viewState?(n.viewStateUpdateRequested=u,null):(n.viewStateUpdateRequested=null,(l=e.onViewStateChange)===null||l===void 0?void 0:l.call(e,u))},v=u=>{if(f)n.interactionStateUpdateRequested=u;else{var l;n.interactionStateUpdateRequested=null,(l=e.onInteractionStateChange)===null||l===void 0||l.call(e,u)}},k=o.useMemo(()=>{const u={...e,style:null,width:"100%",height:"100%",parent:i.current,canvas:a.current,layers:d.layers,views:d.views,onViewStateChange:p,onInteractionStateChange:v};return delete u._customRender,n.deck&&n.deck.setProps(u),u},[e]);o.useEffect(()=>{const u=e.Deck||b;return n.deck=H(n,u,{...k,parent:i.current,canvas:a.current}),()=>{var l;return(l=n.deck)===null||l===void 0?void 0:l.finalize()}},[]),I(()=>{x(n);const{viewStateUpdateRequested:u,interactionStateUpdateRequested:l}=n;u&&p(u),l&&v(l)}),o.useImperativeHandle(t,()=>F(n),[]);const y=n.deck&&n.deck.isInitialized?n.deck.getViewports():void 0,{ContextProvider:w,width:h,height:V,id:g,style:L}=e,{containerStyle:O,canvasStyle:M}=o.useMemo(()=>$({width:h,height:V,style:L}),[h,V,L]);if(!n.viewStateUpdateRequested&&n.lastRenderedViewports===y||n.version!==r){n.lastRenderedViewports=y,n.version=r;const u=G({children:d.children,deck:n.deck,ContextProvider:w}),l=o.createElement("canvas",{key:"canvas",id:g||"deckgl-overlay",ref:a,style:M});n.control=o.createElement("div",{id:"".concat(g||"deckgl","-wrapper"),ref:i,style:O},[l,u])}return f=!1,n.control});E.defaultProps=b.defaultProps;const J=E;export{J as D};
